/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(e){var t=e();typeof window!="undefined"&&(window.Virtjs=t),typeof module!="undefined"&&(module.exports=t),typeof define=="function"&&define.amd&&define([],function(){return t})})(function(){var requirejs,require,define;return function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}}(),define("../tools/Almond-0.2.9.min",function(){}),define("../../libraries/base/./core/../utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./core/../utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./core/../utils/Debug",[],function(){var Esprima=typeof window!="undefined"?window.esprima:require("esprima"),Escodegen=typeof window!="undefined"?window.escodegen:require("escodegen"),executePreprocessing=function(preprocess,root){return findBranches(root,function(node){if(!usesPreprocessVariable(node.test))return node;if(usesUndeclaredVariables(node.test,["this","arguments","preprocess"]))throw new Error("Preprocessed branches cannot access other variables than `preprocess`");var test=Escodegen.generate(node.test),branch=eval(test)?node.consequent:node.alternate;return executePreprocessing(preprocess,branch||{type:"EmptyStatement"})})},findBranches=function(e,t){return e.type==="IfStatement"&&(e=t(e)),Object.keys(e).forEach(function(n){var r=e[n];if(typeof r!="object"||r===null)return;if(!Array.isArray(r)){e[n]=findBranches(r,t);return}r.forEach(function(e,n){r[n]=findBranches(e,t)})}),e},usesPreprocessVariable=function(e){return e.type==="Identifier"&&e.name==="preprocess"?!0:e.type==="MemberExpression"?!1:Object.keys(e).some(function(t){var n=e[t];return typeof n!="object"||n===null?!1:Array.isArray(n)?n.some(function(e){return usesPreprocessVariable(e)}):usesPreprocessVariable(n)})},usesUndeclaredVariables=function(e,t){return!1},isVariable=function(e){return function(t){return t.type==="Identifier"&&t.name===e}},validatesWhitelist=function(e){return function(t){return t.type!=="Identifier"||e.indexOf(t.name)!==-1}};return{monitorFunction:function(){if(typeof arguments[1]=="function")var e=arguments[0],t=arguments[1];else var n=arguments[0],r=arguments[1],e=n[r],t=arguments[2];typeof t=="undefined"&&(t=function(t,n,i){var s=t?"instancied":"called",o=JSON.stringify(Array.prototype.slice.call(i));console.trace('Monitored function "'+(r||e.name)+'" '+s+" with arguments "+o)});var i=function(){var n=this instanceof i;t&&t(n,this,arguments);if(!n)return e.apply(this,arguments);var r=[null].concat(Array.prototype.slice.call(arguments)),s=Function.prototype.bind.apply(e,r);return new s};return i.drop=function(){t=null},n&&(n[r]=i),i},preprocessFunction:function(){if(arguments.length<=2)var fn=arguments[0],preprocess=arguments[1];else var instance=arguments[0],method=arguments[1],fn=instance[method],preprocess=arguments[2];var ast=Esprima.parse("("+fn.toString()+")");if(usesUndeclaredVariables(ast))throw new Error("Preprocessed functions cannot make use of non-local variables");var newFn=eval((instance?"instance."+method+" = ":"")+Escodegen.generate(executePreprocessing(preprocess,ast)));return newFn}}}),define("../../libraries/base/./core/Engine",["../utils/Class","../utils/Debug"],function(e,t){return e.extend({initialize:function(){t.preprocessFunction(this,"_setStatus",this._options),this._setStatus("stopped"),this._waiting=!1,this._nextTick_=this._nextTick.bind(this)},load:function(){var e=arguments[this.load.length-1]||{},t=e.autoResume;return typeof t=="undefined"&&(t=!0),this._status!=="stopped"&&this._setStatus("paused"),this._load.apply(this,arguments),this._status!=="paused"&&this._setStatus("paused"),t&&this.resume(),this},resume:function(){if(this._status!=="paused")return;this._setStatus("running"),this._waiting||this._nextTick()},pause:function(){if(this._status!=="running")return;this._setStatus("paused")},one:function(){if(this._status!=="paused")return;this._setStatus("running"),this.step(),this._setStatus("paused")},stop:function(){if(this._status!=="running"&&this._status!=="paused")return;this._setStatus("stopped")},_setStatus:function(e){this._status=e,typeof preprocess!="undefined"&&(preprocess.events||[]).indexOf("status")!==-1&&this.emit("status",{status:e})},_nextTick:function(){this._status!=="running"?this._waiting=!1:(this.devices.timer.nextTick(this._nextTick_),this.step(),this._waiting=!0)}})}),define("../../libraries/base/./devices/data/../../mixins/Emitter",[],function(){return{on:function(e,t){typeof this._listeners=="undefined"&&(this._listeners={}),typeof this._listeners[e]=="undefined"&&(this._listeners[e]=[]),this._listeners[e].push(t)},off:function(e,t){if(typeof this._listeners=="undefined")return;if(typeof this._listeners[e]=="undefined")return;var n=this._listeners[e].indexOf(t);this._listeners[e].splice(n,1)},emit:function(e,t){if(typeof this._listeners=="undefined")return;if(typeof this._listeners[e]=="undefined")return;this._listeners[e].forEach(function(e){e(t)});if(typeof this._listeners["*"]=="undefined")return;this._listeners["*"].forEach(function(n){n(e,t)})}}}),define("../../libraries/base/./devices/data/../../utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./devices/data/../../utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./devices/data/LocalStorage",["../../mixins/Emitter","../../utils/Class"],function(e,t){return t.extend([e],{initialize:function(){this._localStorage=window.localStorage},requestSave:function(){this.emit("requestSave",null)},save:function(e,t){this._saveData(e+".format",this._getFormat(t)),this._saveTree(e+".data",t)},restore:function(e){var t=this._restoreData(e+".format");return t===null?null:this._restoreTree(e+".data",t)},_getFormat:function(e){var t={};return Object.keys(e).forEach(function(n){t[n]=e[n]&&e[n].constructor===Object?this._getFormat(e[n]):null},this),t},_saveTree:function(e,t){Object.keys(t).forEach(function(n){var r=t[n]&&t[n]===Object?"_saveTree":"_saveData";this[r](e+"."+n,t[n])},this)},_saveData:function(e,t){var n=this._serialize(t);this._localStorage.setItem(e,n)},_restoreTree:function(e,t){var n={};return Object.keys(t).forEach(function(t){n[t]=this._restoreData(e+"."+t)},this),n},_restoreData:function(e){var t=this._localStorage.getItem(e);return t===null?null:this._unserialize(t)},_serialize:function(e){return e&&e.constructor===ArrayBuffer?"B"+String.fromCharCode.apply(null,new Uint8Array(e)):"J"+JSON.stringify(e)},_unserialize:function(e){switch(e[0]){case"J":return JSON.parse(e.substr(1));case"B":var t=e.substr(1),n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(var i=0,s=t.length;i<s;++i)r[i]=t.charCodeAt(i);return r;default:throw new Error("Cannot unserialize data")}}})}),define("../../libraries/base/./devices/debug/../../utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./devices/debug/../../utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./devices/debug/../../utils/Format",[],function(){return{decimal:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(10);if(typeof t!="undefined")while(n.length<t)n="0"+n;return n},relativeAddress:function(e,t,n,r){var i=t<0?"-":"+";if(typeof t!="string"||!isNaN(t))t=this.address(Math.abs(t),r);return this.address(e,n)+i+t},decimal:function(e,t){e=e.toString();if(typeof t=="undefined")return e;for(var n=e.length;n<t;++n)e="0"+e;return e},string:function(e,t,n){e=e.toString();if(typeof t=="undefined")return e;typeof n=="undefined"&&(n=!0);for(var r=e.length;r<t;++r)n?e+=" ":e=" "+e;return e},address:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(16).toLowerCase();if(typeof t!="undefined")while(n.length<Math.ceil(t/4))n="0"+n;return"$"+n},hexadecimal:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(16).toLowerCase();if(typeof t!="undefined")while(n.length<Math.ceil(t/4))n="0"+n;return"0x"+n},binary:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(2);if(typeof t!="undefined")while(n.length<t)n="0"+n;return"0b"+n}}}),define("../../libraries/base/./devices/debug/Tracer",["../../utils/Class","../../utils/Format"],function(e,t){var n=function(e,t,n){return n?"âœ“":""};return e.extend({initialize:function(e,r){this._engine=e,this._options=r||{},this._instructions=[],this._byAddress={},this._breakpoints={},this._breakDelay=0,this._skipBreakpoint=!1,this._domEnabled=!0,this._instructions.getItemMetadata=function(e){return{cssClasses:["tracer-row",this._currentAddress===this._instructions[e].address?"tracer-current":""].join(" ")}}.bind(this);var i=function(e,n,r){return t.address(r,this._options.addressSize)}.bind(this),s=function(e,n,r){return r.map(function(e){return t.hexadecimal(e,this._options.opcodeSize)}.bind(this)).join(" ")}.bind(this),o=[{name:"Breakpoint",field:"breakpoint",cssClass:"tracer-cell tracer-cell-breakpoint",minWidth:100,maxWidth:100,formatter:n},{name:"Address",field:"address",cssClass:"tracer-cell tracer-cell-address",minWidth:120,maxWidth:120,formatter:i},{name:"Opcode",field:"opcode",cssClass:"tracer-cell tracer-cell-opcode",minWidth:200,maxWidth:200,formatter:s},{name:"Instruction",field:"label",cssClass:"tracer-cell tracer-cell-label"}];this._grid=new Slick.Grid(this._options.container,this._instructions,o,{enableTextSelectionOnCells:!0,enableColumnReorder:!1,forceFitColumns:!0}),this._grid.onClick.subscribe(function(e,t){if(t.cell!==0)return;var n=this._grid.getDataItem(t.row);this.toggleBreakpoint(n.address)}.bind(this)),this._grid.onKeyDown.subscribe(function(e,t){if([13,32].indexOf(e.keyCode)===-1)return;var n=this._grid.getDataItem(t.row);this.toggleBreakpoint(n.address)}.bind(this)),this._engine.mmu.on("post-write",function(e){this._refreshFrom(this._findInstruction(e.address))}.bind(this)),this._engine.on("load",function(){this._refreshAll(),this.enableDOM()}.bind(this)),this._engine.cpu.on("instruction",function(e){this._jumpCheck(e),this._breakCheck(e),this._updateCurrent(e)}.bind(this))},"continue":function(){this._skipBreakpoint=!0,this._engine.resume()},one:function(){this._skipBreakpoint=!0,this._breakDelay=2,this._engine.resume()},toggleBreakpoint:function(e){var t=!this._breakpoints[e];this._breakpoints[e]=t;var n=this._byAddress[e];if(!n)return;n.breakpoint=t,this._updateAddress(e),this._render()},disableDOM:function(){if(!this._domEnabled)return;var e=this._currentAddress;this._currentAddress=undefined,this._updateAddress(e),this._render(),this._currentAddress=e,this._options.container.className+=" tracer-disabled",this._domEnabled=!1},enableDOM:function(){if(this._domEnabled)return;this._domEnabled=!0,this._options.container.className=this._options.container.className.replace(/\btracer-disabled\b/g,""),this._invalidate(),this._updateRowCount(),this._render(),this._focusCurrent()},pause:function(){this._breakDelay=1},render:function(){if(!this._domEnabled)return;this._render()},_refreshAll:function(){this._instructions.length=0;for(var e,t=0,n=this._options.memorySize;t<n;t+=e.size){var e=this._engine.disassembleAt(t);e.breakpoint=this._breakpoints[t],this._byAddress[t]=e,this._instructions.push(e)}this._invalidate(),this._requestRender()},_refreshFrom:function(e){var t=e.address,n=this._instructions.indexOf(e),r=n;do{var i=this._engine.disassembleAt(t);for(var s=0;s<i.size;++s){if(!this._byAddress[t+s])continue;delete this._byAddress[t+s],this._instructions.splice(n,1)}this._instructions.splice(n,0,this._byAddress[t]=i),t+=i.size,n+=1}while(t<this._options.memorySize&&!this._byAddress[t]);if(!this._domEnabled)return;this._invalidateRows([r,n]),this._updateRowCount(),this._requestRender()},_findInstruction:function(e){while(e>0&&!this._byAddress[e])e-=1;if(!this._byAddress[e])throw new Error("Instruction not found");return this._byAddress[e]},_dummifyInstruction:function(e){var t=e.address,n=this._instructions.indexOf(e);delete this._byAddress[t],this._instructions.splice(n,1);for(var r=0;r<e.size;++r){var i={address:t+r,label:"db",opcode:[this._engine.byteAt(t+r)],size:1,breakpoint:this._breakpoints[t+r]};this._instructions.splice(n+r,0,this._byAddress[t+r]=i)}},_requestRender:function(){if(!this._domEnabled)return;if(this._pendingRendering)return;this._pendingRendering=window.setTimeout(this._render.bind(this),500)},_invalidate:function(){if(!this._domEnabled)return;this._grid.invalidate()},_invalidateRow:function(e){if(!this._domEnabled)return;this._grid.invalidateRow(e)},_invalidateRows:function(e){if(!this._domEnabled)return;this._grid.invalidateRows(e)},_updateRowCount:function(){if(!this._updateRowCount)return;this._grid.updateRowCount()},_render:function(){window.clearTimeout(this._pendingRendering),this._pendingRendering=undefined,this._grid.render()},_jumpCheck:function(e){if(this._byAddress[e.address])return;this._dummifyInstruction(this._findInstruction(e.address)),this._refreshFrom(this._findInstruction(e.address))},_breakCheck:function(e){var t=this._breakpoints[e.address]&&!this._skipBreakpoint,n=this._breakDelay>0&&!--this._breakDelay;this._skipBreakpoint&&(this._skipBreakpoint=!1);if(!t&&!n)return;e.break(),this.enableDOM()},_updateAddress:function(e){if(!this._domEnabled)return;var t=this._instructions.indexOf(this._byAddress[e]);this._invalidateRow(t)},_updateCurrent:function(e){var t=this._currentAddress;this._currentAddress=e.address;if(!this._domEnabled)return;this._updateAddress(t),this._updateAddress(this._currentAddress),this._render(),this._focusCurrent()},_focusCurrent:function(){var e=this._instructions.indexOf(this._byAddress[this._currentAddress]);this._grid.scrollRowIntoView(e)}})}),define("../../libraries/base/./devices/inputs/../../utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./devices/inputs/../../utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./devices/inputs/../../utils/Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./devices/inputs/../../mixins/Emitter",[],function(){return{on:function(e,t){typeof this._listeners=="undefined"&&(this._listeners={}),typeof this._listeners[e]=="undefined"&&(this._listeners[e]=[]),this._listeners[e].push(t)},off:function(e,t){if(typeof this._listeners=="undefined")return;if(typeof this._listeners[e]=="undefined")return;var n=this._listeners[e].indexOf(t);this._listeners[e].splice(n,1)},emit:function(e,t){if(typeof this._listeners=="undefined")return;if(typeof this._listeners[e]=="undefined")return;this._listeners[e].forEach(function(e){e(t)});if(typeof this._listeners["*"]=="undefined")return;this._listeners["*"].forEach(function(n){n(e,t)})}}}),define("../../libraries/base/./devices/inputs/Button",["../../utils/Class","../../utils/Object","../../mixins/Emitter"],function(e,t,n){return e.extend([n],{initialize:function(e){this._options=t.extend({element:document.body}),this._onMouseDown_=this._onMouseDown.bind(this),this._onMouseUp_=this._onMouseUp.bind(this),this._attach()},destroy:function(){this._detach()},_attach:function(){this._options.element.addEventListener("mousedown",this._onMouseDown_),this._options.element.addEventListener("mouseup",this._onMouseUp_)},_detach:function(){this._options.element.removeEventListener("mousedown",this._onMouseDown_),this._options.element.removeEventListener("mouseup",this._onMouseUp_)},_onMouseDown:function(){if(typeof this._options.code=="undefined")return;this.emit("keydown",this._options.code)},_onMouseUp:function(){if(typeof this._options.code=="undefined")return;this.emit("keyup",this._options.code)}})}),define("../../libraries/base/./devices/inputs/Keyboard",["../../utils/Class","../../utils/Object","../../mixins/Emitter"],function(e,t,n){return e.extend([n],{initialize:function(e){this._options=t.extend({element:document.body,map:{}},e),this._onKeyDown_=this._onKeyDown.bind(this),this._onKeyUp_=this._onKeyUp.bind(this),this._attach()},destroy:function(){this._detach()},_attach:function(){this._options.element.addEventListener("keydown",this._onKeyDown_),this._options.element.addEventListener("keyup",this._onKeyUp_)},_detach:function(){this._options.element.removeEventListener("keydown",this._onKeyDown_),this._options.element.removeEventListener("keyup",this._onKeyUp_)},_onKeyDown:function(e){if(typeof this._options.map[e.keyCode]=="undefined")return;e.preventDefault(),this.emit("keydown",this._options.map[e.keyCode])},_onKeyUp:function(e){if(typeof this._options.map[e.keyCode]=="undefined")return;this.emit("keyup",this._options.map[e.keyCode])}})}),define("../../libraries/base/./devices/inputs/Mixed",["../../utils/Class","../../mixins/Emitter"],function(e,t){return e.extend([t],{initialize:function(e){this._inputs=e,this._onEmit_=this._onEmit.bind(this),e.forEach(function(e){e.on("*",this._onEmit_)}.bind(this))},destroy:function(){this._inputs.forEach(function(e){e.destroy()})},_onEmit:function(e,t){this.emit(e,t)}})}),define("../../libraries/base/./devices/inputs/Null",["../../utils/Class","../../mixins/Emitter"],function(e,t){return e.extend([t],{})}),define("../../libraries/base/./devices/screens/../../utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./devices/screens/../../utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./devices/screens/Sink",["../../utils/Class"],function(e){return e.extend({setInputSize:function(){},setPixel:function(){},flushLine:function(){},flushScreen:function(){}})}),define("../../libraries/base/./devices/screens/WebGL",["../../utils/Class"],function(e){var t=["precision mediump float;","","varying vec2 vTextureCoordinates;","","uniform sampler2D uSampler;","uniform vec2 uResolution;","","void main( void ) {","    vec2 uv2 = vTextureCoordinates * 2.0 - 1.0;","    gl_FragColor = texture2D( uSampler, vec2( vTextureCoordinates.s, 1.0 - vTextureCoordinates.t ) );","    gl_FragColor.rgb *= vec3( .4, .5, .4 );","    //gl_FragColor.a *= 1. - pow( length( uv2 * uv2 * uv2 * uv2 * uv2 ), 5. );","    gl_FragColor.r *= ( ( .5 + abs( .5 - mod( uv2.y       , .021 ) / .021 ) * .5 ) * 3.5 );","    gl_FragColor.g *= ( ( .5 + abs( .5 - mod( uv2.y + .007, .021 ) / .021 ) * .5 ) * 3.5 );","    gl_FragColor.b *= ( ( .5 + abs( .5 - mod( uv2.y + .014, .021 ) / .021 ) * .5 ) * 3.5 );","}"].join("\n"),n=["uniform mat4 uMatrix;","","attribute vec3 aVertexPosition;","attribute vec2 aVertexTexture;","","varying vec2 vTextureCoordinates;","","void main( void ) {","    gl_Position = uMatrix * vec4(aVertexPosition, 1);","    vTextureCoordinates = aVertexTexture;","}"].join("\n");return e.extend({initialize:function(e){this._options=e||{},this._canvas=this._options.element||document.createElement("canvas"),this._canvas.addEventListener("webglcontextlost",function(){this._context=null}.bind(this)),this._canvas.addEventListener("webglcontextrestored",function(){this._setupContext(),this.setOutputSize(this._canvas.width,this._canvas.height)}.bind(this)),this._setupContext(),this.canvas=this._canvas},_setupContext:function(){this._context=this._canvas.getContext("webgl",{antialias:!0})||this._canvas.getContext("experimental-webgl"),this._context.clearColor(0,0,0,0),this._context.blendFunc(this._context.SRC_ALPHA,this._context.ONE_MINUS_SRC_ALPHA),this._context.enable(this._context.BLEND),this._textures=[this._createTexture(),this._createTexture()],this._fragmentShader=this._createShader(this._context.FRAGMENT_SHADER,t),this._vertexShader=this._createShader(this._context.VERTEX_SHADER,n),this._vertexPositionBuffer=this._createBuffer(this._context.ARRAY_BUFFER,4,new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])),this._vertexTextureBuffer=this._createBuffer(this._context.ARRAY_BUFFER,4,new Float32Array([0,0,1,0,1,1,0,1])),this._vertexIndexBuffer=this._createBuffer(this._context.ELEMENT_ARRAY_BUFFER,4,new Uint16Array([0,1,3,2])),this._linkShaders(this._fragmentShader,this._vertexShader)},setInputSize:function(e,t){this._width=e,this._height=t,this._data=new Uint8Array(this._width*this._height*3),this._updateViewport()},setOutputSize:function(e,t){this._canvas.width=e,this._canvas.height=t,this._context&&this._context.viewport(0,0,this._canvas.width,this._canvas.height),this._updateViewport()},setPixel:function(e,t,n,r,i){var s=this._data,o=(t*this._width+e)*3;s[o+0]=n,s[o+1]=r,s[o+2]=i},flushScreen:function(){this._draw()},_createTexture:function(){var e=this._context.createTexture();return e},_createShader:function(e,t){var n=this._context.createShader(e);this._context.shaderSource(n,t),this._context.compileShader(n);if(!this._context.getShaderParameter(n,this._context.COMPILE_STATUS)){var r=this._context.getShaderInfoLog(n);throw new Error("Shader compilation failed : "+r)}return n},_createBuffer:function(e,t,n){var r=this._context.createBuffer();return r.bufferTarget=e,r.itemCount=t,r.itemSize=n.length/t,this._context.bindBuffer(r.bufferTarget,r),this._context.bufferData(r.bufferTarget,n,this._context.STATIC_DRAW),r},_createOrthoMatrix:function(e,t,n,r,i,s){var o=1/(e-t),u=1/(n-r),a=1/(i-s);return[-2*o,0,0,0,0,-2*u,0,0,0,0,2*a,0,(e+t)*o,(n+r)*u,(i+s)*a,1]},_linkShaders:function(){var e=this._shaderProgram=this._context.createProgram();this._context.attachShader(e,this._vertexShader),this._context.attachShader(e,this._fragmentShader),this._context.linkProgram(e);if(!this._context.getProgramParameter(e,this._context.LINK_STATUS))throw new Error("Shader linking failed");this._context.useProgram(e),this._matrixLocation=this._context.getUniformLocation(e,"uMatrix"),this._samplerUniform=this._context.getUniformLocation(e,"uSample"),this._context.uniform1i(this._samplerUniform,0),this._resolutionwebglLocation=this._context.getUniformLocation(e,"uResolution"),this._vertexPositionAttribute=this._context.getAttribLocation(e,"aVertexPosition"),this._context.enableVertexAttribArray(this._vertexPositionAttribute),this._vertexTextureAttribute=this._context.getAttribLocation(e,"aVertexTexture"),this._context.enableVertexAttribArray(this._vertexTextureAttribute)},_updateViewport:function(){if(!this._context)return;var e=this._canvas.width/this._width,t=this._canvas.height/this._height,n=Math.min(e,t),r=e/n,i=t/n,s=this._createOrthoMatrix(-r,r,-i,i,-100,100);this._context.uniformMatrix4fv(this._matrixLocation,!1,s),this._context.uniform2f(this._resolutionLocation,r,i)},_draw:function(){if(!this._context)return;this._context.clear(this._context.COLOR_BUFFER_BIT|this._context.DEPTH_BUFFER_BIT),this._context.bindBuffer(this._vertexPositionBuffer.bufferTarget,this._vertexPositionBuffer),this._context.vertexAttribPointer(this._vertexPositionAttribute,this._vertexPositionBuffer.itemSize,this._context.FLOAT,!1,0,0),this._context.bindBuffer(this._vertexTextureBuffer.bufferTarget,this._vertexTextureBuffer),this._context.vertexAttribPointer(this._vertexTextureAttribute,this._vertexTextureBuffer.itemSize,this._context.FLOAT,!1,0,0),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._textures[0]),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGB,this._width,this._height,0,this._context.RGB,this._context.UNSIGNED_BYTE,this._data),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.LINEAR),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.bindBuffer(this._vertexIndexBuffer.bufferTarget,this._vertexIndexBuffer),this._context.drawElements(this._context.TRIANGLE_STRIP,this._vertexIndexBuffer.itemCount,this._context.UNSIGNED_SHORT,0)}})}),define("../../libraries/base/./devices/timers/../../utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./devices/timers/../../utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./devices/timers/Immediate",["../../utils/Class"],function(e){return e.extend({nextTick:function(e){setImmediate(function(){e()})},createTimeout:function(e,t){return setTimeout(function(){e()},t)},cancelTimeout:function(e){clearTimeout(e)}})}),define("../../libraries/base/./devices/timers/RAFrame",["../../utils/Class"],function(e){return e.extend({initialize:function(e){e=e||{},this._onTick_=this._onTick.bind(this),this._tickRequest=null,this._nextTicks=[],this._nextTicksBackup=[],this._fpsMeter=e.fpsMeter||{tickStart:function(){},tick:function(){}}},nextTick:function(e){this._nextTicks.push(e),this._tickRequest===null&&(this._tickRequest=window.requestAnimationFrame(this._onTick_))},createTimeout:function(e,t){return window.setTimeout(function(){e()},t)},cancelTimeout:function(e){window.clearTimeout(e)},_onTick:function(){this._tickRequest=null,this._fpsMeter.tickStart();var e=this._nextTicks;this._nextTicks=this._nextTicksBackup,this._nextTicksBackup=e;for(var t=0,n=e.length;t<n;++t)e[t]();e.length=0,this._fpsMeter.tick()}})}),define("../../libraries/base/./devices/timers/Sink",["../../utils/Class"],function(e){return e.extend({nextTick:function(e){},createTimeout:function(e,t){},cancelTimeout:function(e){}})}),define("../../libraries/base/./mixins/Emitter",[],function(){return{on:function(e,t){typeof this._listeners=="undefined"&&(this._listeners={}),typeof this._listeners[e]=="undefined"&&(this._listeners[e]=[]),this._listeners[e].push(t)},off:function(e,t){if(typeof this._listeners=="undefined")return;if(typeof this._listeners[e]=="undefined")return;var n=this._listeners[e].indexOf(t);this._listeners[e].splice(n,1)},emit:function(e,t){if(typeof this._listeners=="undefined")return;if(typeof this._listeners[e]=="undefined")return;this._listeners[e].forEach(function(e){e(t)});if(typeof this._listeners["*"]=="undefined")return;this._listeners["*"].forEach(function(n){n(e,t)})}}}),define("../../libraries/base/./mixins/Iterable",[],function(){return{slice:function(e,t){var n=this.length();typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=n);var r=e<0?n+e:e,i=Math.min(r+t,n),s=[];for(var o=r;o<i;++o)s.push(this.at(o));return s},forEach:function(e,t){for(var n=0,r=this.length();n<r;++n)e.call(t,this.at(n),n,this)},map:function(e,t){var n=[];for(var r=0,i=this.length();r<i;++r)n.push(e.call(t,this.at(r),r,this));return n},filter:function(e,t){var n=[];for(var r=0,i=this.length();r<i;++r){var s=this.at(r);e.call(t,s,r,this)&&n.push(s)}return n},reduce:function(e,t,n){var r=0;typeof t=="undefined"&&(t=this.at(r++));for(var i=this.length();r<i;++r)t=e.call(n,t,this.at(r),r,this);return t}}}),define("../../libraries/base/./utils/./Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./utils/Class",["./Object"],function(e){var t=function(){var e=this;e._options=arguments[e.initialize.length]||{},e.initialize.apply(e,arguments)};return t.extend=function(n,r,i){n instanceof Array||(i=r,r=n,n=[]);var s=function(){return t.apply(this,arguments)},o=function(){};return o.prototype=this.prototype,s.prototype=new o,s.prototype.constructor=s,n.forEach(function(t){e.extend(s.prototype,t)}),e.extend(s,this,i),e.extend(s.prototype,r),s},t.bindConstructor=function(){var e=Array.prototype.slice.call(arguments);return this.bind.apply(this,[null].concat(e))},t.prototype.initialize=function(){},t}),define("../../libraries/base/./utils/Debug",[],function(){var Esprima=typeof window!="undefined"?window.esprima:require("esprima"),Escodegen=typeof window!="undefined"?window.escodegen:require("escodegen"),executePreprocessing=function(preprocess,root){return findBranches(root,function(node){if(!usesPreprocessVariable(node.test))return node;if(usesUndeclaredVariables(node.test,["this","arguments","preprocess"]))throw new Error("Preprocessed branches cannot access other variables than `preprocess`");var test=Escodegen.generate(node.test),branch=eval(test)?node.consequent:node.alternate;return executePreprocessing(preprocess,branch||{type:"EmptyStatement"})})},findBranches=function(e,t){return e.type==="IfStatement"&&(e=t(e)),Object.keys(e).forEach(function(n){var r=e[n];if(typeof r!="object"||r===null)return;if(!Array.isArray(r)){e[n]=findBranches(r,t);return}r.forEach(function(e,n){r[n]=findBranches(e,t)})}),e},usesPreprocessVariable=function(e){return e.type==="Identifier"&&e.name==="preprocess"?!0:e.type==="MemberExpression"?!1:Object.keys(e).some(function(t){var n=e[t];return typeof n!="object"||n===null?!1:Array.isArray(n)?n.some(function(e){return usesPreprocessVariable(e)}):usesPreprocessVariable(n)})},usesUndeclaredVariables=function(e,t){return!1},isVariable=function(e){return function(t){return t.type==="Identifier"&&t.name===e}},validatesWhitelist=function(e){return function(t){return t.type!=="Identifier"||e.indexOf(t.name)!==-1}};return{monitorFunction:function(){if(typeof arguments[1]=="function")var e=arguments[0],t=arguments[1];else var n=arguments[0],r=arguments[1],e=n[r],t=arguments[2];typeof t=="undefined"&&(t=function(t,n,i){var s=t?"instancied":"called",o=JSON.stringify(Array.prototype.slice.call(i));console.trace('Monitored function "'+(r||e.name)+'" '+s+" with arguments "+o)});var i=function(){var n=this instanceof i;t&&t(n,this,arguments);if(!n)return e.apply(this,arguments);var r=[null].concat(Array.prototype.slice.call(arguments)),s=Function.prototype.bind.apply(e,r);return new s};return i.drop=function(){t=null},n&&(n[r]=i),i},preprocessFunction:function(){if(arguments.length<=2)var fn=arguments[0],preprocess=arguments[1];else var instance=arguments[0],method=arguments[1],fn=instance[method],preprocess=arguments[2];var ast=Esprima.parse("("+fn.toString()+")");if(usesUndeclaredVariables(ast))throw new Error("Preprocessed functions cannot make use of non-local variables");var newFn=eval((instance?"instance."+method+" = ":"")+Escodegen.generate(executePreprocessing(preprocess,ast)));return newFn}}}),define("../../libraries/base/./utils/Format",[],function(){return{decimal:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(10);if(typeof t!="undefined")while(n.length<t)n="0"+n;return n},relativeAddress:function(e,t,n,r){var i=t<0?"-":"+";if(typeof t!="string"||!isNaN(t))t=this.address(Math.abs(t),r);return this.address(e,n)+i+t},decimal:function(e,t){e=e.toString();if(typeof t=="undefined")return e;for(var n=e.length;n<t;++n)e="0"+e;return e},string:function(e,t,n){e=e.toString();if(typeof t=="undefined")return e;typeof n=="undefined"&&(n=!0);for(var r=e.length;r<t;++r)n?e+=" ":e=" "+e;return e},address:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(16).toLowerCase();if(typeof t!="undefined")while(n.length<Math.ceil(t/4))n="0"+n;return"$"+n},hexadecimal:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(16).toLowerCase();if(typeof t!="undefined")while(n.length<Math.ceil(t/4))n="0"+n;return"0x"+n},binary:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(2);if(typeof t!="undefined")while(n.length<t)n="0"+n;return"0b"+n}}}),define("../../libraries/base/./utils/Function",[],function(){return{fastBind:function(fn,context){var argumentCount=fn.length,providenArguments=Array.prototype.slice.call(arguments,2);return fn.bind.apply(fn,[context].concat(providenArguments));var parameterStringParts,parameterString,argumentString}}}),define("../../libraries/base/./utils/Log",[],function(){return{image:function(e){var t=e.width,n=e.height,r=e.toDataUrl();console.log("%c",function(e){return Object.keys(e).map(function(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+e[t]}).join(";")}({lineHeight:0,paddingLeft:t+"px",paddingTop:n+"px",backgroundImage:"url("+r+")"}))}}}),define("../../libraries/base/./utils/./Format",[],function(){return{decimal:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(10);if(typeof t!="undefined")while(n.length<t)n="0"+n;return n},relativeAddress:function(e,t,n,r){var i=t<0?"-":"+";if(typeof t!="string"||!isNaN(t))t=this.address(Math.abs(t),r);return this.address(e,n)+i+t},decimal:function(e,t){e=e.toString();if(typeof t=="undefined")return e;for(var n=e.length;n<t;++n)e="0"+e;return e},string:function(e,t,n){e=e.toString();if(typeof t=="undefined")return e;typeof n=="undefined"&&(n=!0);for(var r=e.length;r<t;++r)n?e+=" ":e=" "+e;return e},address:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(16).toLowerCase();if(typeof t!="undefined")while(n.length<Math.ceil(t/4))n="0"+n;return"$"+n},hexadecimal:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(16).toLowerCase();if(typeof t!="undefined")while(n.length<Math.ceil(t/4))n="0"+n;return"0x"+n},binary:function(e,t){if(isNaN(e))return"NaN";var n=e.toString(2);if(typeof t!="undefined")while(n.length<t)n="0"+n;return"0b"+n}}}),define("../../libraries/base/./utils/./Function",[],function(){return{fastBind:function(fn,context){var argumentCount=fn.length,providenArguments=Array.prototype.slice.call(arguments,2);return fn.bind.apply(fn,[context].concat(providenArguments));var parameterStringParts,parameterString,argumentString}}}),define("../../libraries/base/./utils/Memory",["./Format","./Function"],function(e,t){return{unaddressable:function(t,n){return function(t,r){throw new Error("Address "+e.address(r,n)+" is unaddressable")}},immutable:function(e){return function(){return e}},accessor:function(){if(!arguments[0])throw new Error("Undefined accessor cannot be bound");return t.fastBind.apply(t,arguments)},plainOldData:function(e,t){if(!e)throw new Error("Un undefined object cannot be mapped");return[e,t]}}}),define("../../libraries/base/./utils/Object",[],function(){return{extend:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r==null)continue;Object.keys(r).forEach(function(t){e[t]=r[t]})}return e}}}),define("../../libraries/base/./utils/Reflection",[],function(){return{resetScope:function(){var reflectionInstance,reflectionMember,reflectionFunction,reflectionNewScope;return arguments.length<=2?(reflectionFunction=arguments[0],reflectionNewScope=arguments[1]):arguments.length<=3?(reflectionInstance=arguments[0],reflectionMember=arguments[1],reflectionFunction=arguments[0][arguments[1]],reflectionNewScope=arguments[2]):arguments.length<=4&&(reflectionInstance=arguments[0],reflectionMember=arguments[1],reflectionFunction=arguments[2],reflectionNewScope=arguments[3]),Object.keys(reflectionNewScope).length&&eval("var "+Object.keys(reflectionNewScope).map(function(e){return e+" = reflectionNewScope."+e}).join(",")+";"),eval((reflectionInstance?"reflectionInstance."+reflectionMember+" = ":"")+"("+reflectionFunction.toString()+")")}}}),define("../../libraries/base/index",["./core/Engine","./devices/data/LocalStorage","./devices/debug/Tracer","./devices/inputs/Button","./devices/inputs/Keyboard","./devices/inputs/Mixed","./devices/inputs/Null","./devices/screens/Sink","./devices/screens/WebGL","./devices/timers/Immediate","./devices/timers/RAFrame","./devices/timers/Sink","./mixins/Emitter","./mixins/Iterable","./utils/Class","./utils/Debug","./utils/Format","./utils/Function","./utils/Log","./utils/Memory","./utils/Object","./utils/Reflection"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){return{ClassUtil:d,DebugUtil:v,FormatUtil:m,FunctionUtil:g,LogUtil:y,MemoryUtil:b,ObjectUtil:w,ReflectionUtil:E,EmitterMixin:h,IterableMixin:p,Engine:e,data:{LocalStorage:t},input:{Button:r,Keyboard:i,Null:o},screen:{Sink:u,WebGL:a},timer:{RAFrame:l,Immediate:f,Sink:c},debug:{Tracer:n},engine:{},create:function(e,t){return new e.Engine(t)}}}),require("../../libraries/base/index")});